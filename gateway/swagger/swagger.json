{
    "swagger": "2.0",
    "info": {
        "description": "Описание эндпоинтов сервиса анонимизации данных",
        "title": "Anonix Gateway API",
        "contact": {},
        "version": "1.0"
    },
    "basePath": "/api/v1",
    "paths": {
        "/auth/isAdmin": {
            "post": {
                "description": "По переданному user_id возвращает, является ли пользователь администратором",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Проверить админство пользователя",
                "parameters": [
                    {
                        "description": "ID пользователя",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.IsAdminSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.IsAdminRespSchema"
                        }
                    },
                    "400": {
                        "description": "invalid request body"
                    },
                    "500": {
                        "description": "failed to check if user is admin"
                    }
                }
            }
        },
        "/auth/refresh": {
            "post": {
                "description": "Принимает refresh token, возвращает новый access и refresh token",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Обновить токены",
                "parameters": [
                    {
                        "description": "Refresh token",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.RefreshSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.RefreshRespSchema"
                        }
                    },
                    "400": {
                        "description": "invalid request body / failed to refresh token"
                    },
                    "500": {
                        "description": "unexpected error"
                    }
                }
            }
        },
        "/auth/signIn": {
            "post": {
                "description": "Возвращает токен доступа и токен обновления",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Авторизация",
                "parameters": [
                    {
                        "description": "Данные для авторизации",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.LoginSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.LoginRespSchema"
                        }
                    },
                    "400": {
                        "description": "invalid request body"
                    },
                    "401": {
                        "description": "invalid credentials"
                    },
                    "500": {
                        "description": "failed to log in"
                    }
                }
            }
        },
        "/auth/signUp": {
            "post": {
                "description": "Возвращает ID пользователя",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Auth"
                ],
                "summary": "Зарегистрировать пользователя",
                "parameters": [
                    {
                        "description": "Данные для регистрации",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.RegisterSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.RegisterRespSchema"
                        }
                    },
                    "400": {
                        "description": "invalid request body"
                    },
                    "409": {
                        "description": "user with same login already exists"
                    },
                    "500": {
                        "description": "failed to register user"
                    }
                }
            }
        },
        "/detokenize": {
            "post": {
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "description": "Принимает токен, ищет соответствующий mapping и возвращает исходный plaintext",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Tokenizer"
                ],
                "summary": "Детокенизация",
                "parameters": [
                    {
                        "description": "Токен для детокенизации",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.DetokenizeSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.DetokenizeRespSchema"
                        }
                    },
                    "400": {
                        "description": "invalid request body / invalid arguments"
                    },
                    "404": {
                        "description": "token not found / token expired"
                    },
                    "500": {
                        "description": "failed to detokenize / unexpected error"
                    }
                }
            }
        },
        "/mappings/": {
            "get": {
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "description": "Возвращает список маппингов",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Mappings"
                ],
                "summary": "Получить список маппингов",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/schemas.MappingSchema"
                            }
                        }
                    },
                    "500": {
                        "description": "failed to get mapping list"
                    }
                }
            }
        },
        "/mappings/{id}": {
            "get": {
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "description": "Возвращает объект маппинга",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Mappings"
                ],
                "summary": "Получить маппинг по ID",
                "parameters": [
                    {
                        "type": "string",
                        "description": "ID маппинга",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.MappingSchema"
                        }
                    },
                    "400": {
                        "description": "invalid token ID"
                    },
                    "404": {
                        "description": "mapping not found"
                    },
                    "500": {
                        "description": "internal error"
                    }
                }
            },
            "delete": {
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "description": "Удаляет объект маппинга по ID.",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Mappings"
                ],
                "summary": "Удалить маппинг по ID",
                "parameters": [
                    {
                        "type": "string",
                        "description": "ID маппинга",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "400": {
                        "description": "invalid token ID"
                    },
                    "401": {
                        "description": "unauthorized"
                    },
                    "404": {
                        "description": "mapping not found"
                    },
                    "500": {
                        "description": "internal error"
                    }
                }
            },
            "patch": {
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "description": "Возвращает объект маппинга",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Mappings"
                ],
                "summary": "Обновить маппинг по ID",
                "parameters": [
                    {
                        "type": "string",
                        "description": "ID маппинга",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Данные для обновления",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.UpdateMappingSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.MappingSchema"
                        }
                    },
                    "400": {
                        "description": "invalid token ID"
                    },
                    "404": {
                        "description": "mapping not found"
                    },
                    "500": {
                        "description": "internal error"
                    }
                }
            }
        },
        "/tokenize": {
            "post": {
                "security": [
                    {
                        "ApiKeyAuth": []
                    }
                ],
                "description": "Принимает plaintext и параметры токенизации, возвращает созданный токен и метаданные",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Tokenizer"
                ],
                "summary": "Токенизация",
                "parameters": [
                    {
                        "description": "Данные для токенизации",
                        "name": "body",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/schemas.TokenizeSchema"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/schemas.MappingSchema"
                        }
                    },
                    "400": {
                        "description": "invalid request body / invalid arguments"
                    },
                    "409": {
                        "description": "token already exists"
                    },
                    "500": {
                        "description": "failed to tokenize / unexpected error"
                    }
                }
            }
        }
    },
    "definitions": {
        "schemas.DetokenizeRespSchema": {
            "type": "object",
            "properties": {
                "plaintext": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                }
            }
        },
        "schemas.DetokenizeSchema": {
            "type": "object",
            "properties": {
                "token": {
                    "type": "string"
                }
            }
        },
        "schemas.IsAdminRespSchema": {
            "type": "object",
            "properties": {
                "result": {
                    "type": "boolean"
                }
            }
        },
        "schemas.IsAdminSchema": {
            "type": "object",
            "properties": {
                "user_id": {
                    "type": "string"
                }
            }
        },
        "schemas.LoginRespSchema": {
            "type": "object",
            "properties": {
                "access_token": {
                    "type": "string"
                },
                "refresh_token": {
                    "type": "string"
                },
                "user_id": {
                    "type": "string"
                }
            }
        },
        "schemas.LoginSchema": {
            "type": "object",
            "properties": {
                "login": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                }
            }
        },
        "schemas.MappingSchema": {
            "type": "object",
            "properties": {
                "cipher_text": {
                    "type": "string",
                    "example": "rfAsPo1N0a3cBiELOlgmHUXS5Q=="
                },
                "created_at": {
                    "type": "string",
                    "example": "2006-01-02T15:04:05Z07:00"
                },
                "dek_wrapped": {
                    "type": "string",
                    "example": "dmF1bHQ6djE6dTZCY0lXRURFOG..."
                },
                "deterministic": {
                    "type": "boolean",
                    "example": true
                },
                "id": {
                    "type": "string",
                    "example": "550e8400-e29b-41d4-a716-446655440000"
                },
                "reversible": {
                    "type": "boolean",
                    "example": true
                },
                "token_ttl": {
                    "type": "string",
                    "example": "24h0m0s"
                }
            }
        },
        "schemas.RefreshRespSchema": {
            "type": "object",
            "properties": {
                "access_token": {
                    "type": "string"
                },
                "refresh_token": {
                    "type": "string"
                }
            }
        },
        "schemas.RefreshSchema": {
            "type": "object",
            "properties": {
                "access_token": {
                    "type": "string"
                },
                "refresh_token": {
                    "type": "string"
                }
            }
        },
        "schemas.RegisterRespSchema": {
            "type": "object",
            "properties": {
                "user_id": {
                    "type": "string"
                }
            }
        },
        "schemas.RegisterSchema": {
            "type": "object",
            "properties": {
                "login": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                },
                "role_id": {
                    "type": "integer"
                }
            }
        },
        "schemas.TokenizeSchema": {
            "type": "object",
            "properties": {
                "deterministic": {
                    "type": "boolean"
                },
                "plaintext": {
                    "type": "array",
                    "items": {
                        "type": "integer"
                    }
                },
                "reversible": {
                    "type": "boolean"
                },
                "token_ttl": {
                    "type": "integer"
                }
            }
        },
        "schemas.UpdateMappingSchema": {
            "type": "object"
        }
    },
    "securityDefinitions": {
        "ApiKeyAuth": {
            "type": "apiKey",
            "name": "Authorization",
            "in": "header"
        }
    }
}